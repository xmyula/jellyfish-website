<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; background-color: #e0f2f1; text-align: center; padding: 20px; }
    .container { background: white; padding: 20px; border-radius: 15px; display: inline-block; min-width: 300px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #00796b; color: white; }
    .btn { margin-top: 20px; padding: 10px 20px; background: #00796b; color: white; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

  <div class="container">
    <h2>ğŸ† å®Œæ•´æ’è¡Œæ¦œ</h2>
    <div id="status">æ­£åœ¨é€£ç·šè‡³è³‡æ–™åº«...</div>
    <table id="rankTable" style="display:none;">
      <thead>
        <tr><th>æ’å</th><th>åå­—</th><th>åˆ†æ•¸</th></tr>
      </thead>
      <tbody id="rankData"></tbody>
    </table>
    
    <button class="btn" onclick="backToGame()">â¬… å›åˆ°éŠæˆ²</button>
  </div>

  <script>
    window.onload = function() {
      try {
        console.log("æ­£åœ¨è«‹æ±‚è³‡æ–™...");
        google.script.run
          .withSuccessHandler(renderTable)
          .withFailureHandler(function(err) {
            document.getElementById('status').innerText = "æŠ“å–å¤±æ•—: " + err;
          })
          .getAllRanking();
      } catch (e) {
        alert("JSåŸ·è¡ŒéŒ¯èª¤: " + e.message);
      }
    };

    function renderTable(data) {
      var status = document.getElementById('status');
      var table = document.getElementById('rankTable');
      var tbody = document.getElementById('rankData');
      
      if (!data || data.length === 0) {
        status.innerText = "ç›®å‰æ²’æœ‰è³‡æ–™";
        return;
      }
      
      status.style.display = 'none';
      table.style.display = 'table';
      
      data.forEach(function(item, i) {
        var row = tbody.insertRow();
        row.insertCell(0).innerText = i + 1;
        row.insertCell(1).innerText = item.name;
        row.insertCell(2).innerText = item.score;
      });
    }

    function backToGame() {
      // å–å¾—ç”± Code.gs å‚³å…¥çš„ç¶²å€
      var url = "<?!= ScriptApp.getService().getUrl() ?>";
      window.top.location.href = url;
    }
  </script>
</body>
</html>
